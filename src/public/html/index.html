<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js" type="text/javascript"></script>
</head>

<body>
  <canvas id="myChart" width="400" height="400"></canvas>
</body>
<script type="text/javascript">
var canvas = document.getElementById('myChart');
var myChart = new Chart(canvas, {
    type: 'line',
    data: {
      datasets: [{
          fillColor: "rgba(220,220,220,0)",
          strokeColor: "rgba(220,180,0,1)",
          pointColor: "rgba(220,180,0,1)",
          data: []
      }],
      rawData: []
    },
    options: {
      events: ['click'],
      scales: {
        xAxes: [{
            type: "time",
            display: true,
            scaleLabel: {
                display: true,
                labelString: 'Date'
            },
            time: {
              unit: "minute"
            }
        }],
        yAxes: [{
            display: true,
            scaleLabel: {
                display: true,
                labelString: 'value'
            }
        }]
      }
    }
});

canvas.onclick = function(evt) {
    var activePoint = myChart.getElementsAtEvent(evt)[0];
};

fetch('http://localhost:3000/api/v1/BTC/data').then((response) => {
  response.json().then(jsonArr => {
    let newData = [];
    jsonArr.forEach((json)=>{
      newData.push({
        x: moment(Number(json.date)),
        y: Number(json.closing_price)
      })
      console.log(json);
    });
    myChart.data.datasets[0].data = newData;
    myChart.data.datasets[0].rawData = jsonArr;
    myChart.update();
  });
});

</script>
</html>
