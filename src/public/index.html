<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js" type="text/javascript"></script>
</head>

<body>
  <div>
    <canvas id="myChart" width="1000" height="400"></canvas>
  </div>
  <div>
    <div style="background-color:#FFFF66;width:150;height:150;border-radius:50%"></div>
  </div>
</body>
<script type="text/javascript">
var canvas = document.getElementById('myChart');
var myChart = new Chart(canvas, {
    type: 'line',
    data: {
      datasets: [{
          label:"한국 거래",
          fillColor: "rgba(220,220,220,0)",
          strokeColor: "rgba(100,100,100,0)",
          pointColor: "rgba(220,180,0,1)",
          data: []
      },
      {
          label:"미국 거래",
          fillColor: "#ff6384",
          strokeColor: "rgba(100,100,100,0)",
          pointColor: "rgba(220,180,0,1)",
          data: []
      }],
      rawData: []
    },
    options: {
      responsive: false,
      events: ['click'],
      scales: {
        xAxes: [{
            type: "time",
            display: true,
            scaleLabel: {
                display: true,
                labelString: 'Date'
            },
            time: {
              unit: "minute"
            }
        }],
        yAxes: [{
            display: true,
            scaleLabel: {
                display: true,
                labelString: 'value'
            }
        }]
      }
    }
});

canvas.onclick = function(evt) {
  var activePoint = myChart.getElementsAtEvent(evt)[0];
  if (!activePoint) {
    return;
  }
  console.log(myChart.data.datasets[0].rawData[activePoint._index]);
};

fetch('http://localhost:3000/api/v1/BTC/data').then((response) => {
  response.json().then(body => {
    let datasetIndex = 0;
    for (let k in body) {
      let data = body[k];
      let newData = [];
      data.forEach((item)=>{
        newData.push({
          x: moment(item.timestamp),
          y: Number(item.price)
        });
      });
      myChart.data.datasets[datasetIndex].data = newData;
      myChart.data.datasets[datasetIndex].rawData = data;
      datasetIndex++;
    }

    myChart.update();
    console.log(body);
  });
});
</script>
</html>
